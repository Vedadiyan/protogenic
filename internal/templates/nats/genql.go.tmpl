// Code generated by protogeinc. DO NOT EDIT.
// versions:
// 	protogenic 	  {{ .ProtogenicVersion }}
// 	protoc        {{ .CompilerVersion }}
// source: {{ .File }}
package {{ .ImportPath }}

import (
	{{- if gt .CacheInterval 0}}
	"time"
	{{- end }}

	helpers "github.com/vedadiyan/goal-helpers/pkg"
	"github.com/vedadiyan/goal/pkg/service"
)

func init() {
	const (
		CN         = "{{ .ConnName }}"
		NS         = "{{ .Namespace }}"
		QUEUE      = "{{ .Queue }}"
	)

	var (
		_query []byte
	)

	type (
		Request  = {{ .RequestType }}
		Response = {{ .ResponseType}}
	)

	_query = {{ .Query }}

	handler := func(m *Request) (*Response, error) {
		var response Response
		err := helpers.Exec(m, _query, &response)
		if err != nil {
			return nil, err
		}
		return &response, nil
	}

	service.Register(
		service.New(
			CN,
			NS,
			QUEUE,
			handler,
			{{- if gt .CacheInterval 0}}
			service.WithCache(time.Millisecond * {{ .CacheInterval }}),
			{{- end }}
			{{- if .Callback.OnSuccess }}
			service.WithOnSuccessCallBacks(
				{{- range $item :=  .Callback.OnSuccess }}
					"{{$item}}",
				{{- end }}
			),
			{{- end }}
			{{- if .Callback.OnError }}
			service.WithOnFailureCallBacks(
				{{- range $item :=  .Callback.OnError }}
					"{{$item}}",
				{{- end }}
			),
			{{- end }}
		),
	)
}