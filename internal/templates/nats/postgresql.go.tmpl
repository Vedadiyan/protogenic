// Code generated by protogeinc. DO NOT EDIT.
// versions:
// 	protogenic 	  {{ .ProtogenicVersion }}
// 	protoc        {{ .CompilerVersion }}
// source: {{ .File }}
package {{ .ImportPath }}

import (
	"time"
	"fmt"

	helpers "github.com/vedadiyan/goal-helpers/pkg"
	"github.com/vedadiyan/goal/pkg/http"
	"github.com/vedadiyan/goal/pkg/service"
)

const (
	_DSN_{{ .MethodName | ToUpperCase }} 		 = "{{ .Dsn }}"
	_CN_{{ .MethodName | ToUpperCase }}          = "{{ .ConnName }}"
	_NS_{{ .MethodName | ToUpperCase }}          = "{{ .Namespace }}"
	_QUEUE_{{ .MethodName | ToUpperCase }}       = "{{ .Queue }}"
	_URL_{{ .MethodName | ToUpperCase }}         = "{{ .Url }}"
	_METHOD_{{ .MethodName | ToUpperCase }}      = "{{ .Method }}"
)

var (
	_url{{ .MethodName | ToPascalCase }}       *http.UrlTemplate
	_reqMapper{{ .MethodName | ToPascalCase }} []byte
	_resMapper{{ .MethodName | ToPascalCase }} []byte
)

type (
	Request{{ .MethodName | ToPascalCase }}  = {{ .RequestType }}
	Response{{ .MethodName | ToPascalCase }} = {{ .ResponseType}}
)

func handler{{ .MethodName | ToPascalCase}}(m *Request{{ .MethodName | ToPascalCase }}) (*Response{{ .MethodName | ToPascalCase }}, error) {
	var request Request{{ .MethodName | ToPascalCase }}
	err := helpers.Exec(m, _reqMapper{{ .MethodName | ToPascalCase }}, &request)
	if err != nil {
		return nil, err
	}

	var response Response{{ .MethodName | ToPascalCase }}
	err := helpers.Exec(m, _resMapper{{ .MethodName | ToPascalCase }}, &response)
	if err != nil {
		return nil, err
	}
	return &response, nil
}

func init() {
	_reqMapper{{ .MethodName | ToPascalCase }} = {{ .RequestMapper }}
	_resMapper{{ .MethodName | ToPascalCase }} = {{ .ResponseMapper }}
	service.Register(
		service.New(
			_CN_{{ .MethodName | ToUpperCase }},
			_NS_{{ .MethodName | ToUpperCase }},
			_QUEUE_{{ .MethodName | ToUpperCase }},
			handler{{ .MethodName | ToPascalCase}},
			func() *Request{{ .MethodName | ToPascalCase }} {
				return &Request{{ .MethodName | ToPascalCase }}{}
			},
			func() *Response{{ .MethodName | ToPascalCase }} {
				return &Response{{ .MethodName | ToPascalCase }}{}
			},
			service.WithCache(time.Millisecond * {{ .CacheInterval }}),
		),
	)
}
